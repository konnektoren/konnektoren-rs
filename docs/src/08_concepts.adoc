ifndef::imagesdir[:imagesdir: ../images]

[[section-concepts]]
== Cross-cutting Concepts

=== Modular Core Library and UI Components

The *konnektoren* project centers on a modular core library containing all business logic, decoupled from any specific user interface.
This enables code reuse across multiple applications (e.g., web, Telegram) and simplifies maintenance and extension.
Reusable UI components are provided for rapid integration and consistent user experience.

[plantuml, core-library, svg]
....
@startuml core-library
package "Konnektoren Core" {
  class BusinessLogic {
    +processData()
    +verifyCertificate()
  }

  package "UI Components" {
    class UIComponent1
    class UIComponent2
    UIComponent1 -- BusinessLogic
    UIComponent2 -- BusinessLogic
  }
}

UIComponent1 <|-- WebApp
UIComponent2 <|-- TelegramApp

@enduml
....

*Diagram: Modular architecture enables UI components to interact with core business logic, supporting multiple frontends.*

**Benefits:**

- Separation of concerns: UI and logic evolve independently.
- Code reuse: Core logic shared across platforms.
- Easier testing and extension.

=== Command and Event Handling Pattern

Konnektoren uses a command/event pattern, primarily via the GameController, to manage game state and user interactions.
Commands trigger actions; events notify subscribers of changes.

[plantuml, command-event-pattern, svg]
----
@startuml
component "GameController" as GC
component "CommandBus" as CB
component "EventBus" as EB
component "GameState" as GS

GC --> CB : publishes commands
CB --> GC : executes commands
GC --> EB : publishes events
GC --> GS : updates
@enduml
----

**Advantages:**

- Decouples components for maintainability.
- Enables extensibility by adding new command/event types.
- Clear control and data flow.
- Facilitates testing and mocking.

=== Web3-Oriented Architecture

The system is designed with web3 principles: minimal server-side storage, privacy by default, and user empowerment.
User data (except leaderboard) is stored client-side, with encryption and digital signatures for verification.

[plantuml, web3-architecture, svg]
....
@startuml
actor User
node "Client" {
  [Local Storage] <<client-side storage>>
  [App Logic]
}

node "Server" {
  [Leaderboard Database] <<Server-Side Storage>>
}

User --> [App Logic] : Interaction
[App Logic] --> [Local Storage] : Store user data
[App Logic] --> [Leaderboard Database] : Update leaderboard

@enduml
....

*Diagram: User data is stored locally; only essential data (leaderboard) is centralized.*

**Benefits:**

- Enhanced privacy and user control.
- Reduced attack surface.
- Offline support.

=== Encryption and Digital Signatures

Data integrity and security are ensured through encryption and digital signatures.
Certificates and sensitive data are signed and verified using industry-standard cryptography (e.g., Ed25519).

[plantuml, encryption-diagram, svg]
....
@startuml
actor User

node "Client" {
  [Encryption] <<Client-Side Operation>>
  [SignatureVerification] <<Client-Side Operation>>
}

node "Server" {
  [Certificate Authority] <<Server-Side Operation>>
}

User --> [Encryption] : Encrypt/Decrypt data
[Encryption] --> [SignatureVerification] : Sign/Verify certificates
[SignatureVerification] --> [Certificate Authority] : Verify signature

@enduml
....

*Diagram: Encryption and signature verification are performed client-side, with server-side certificate authority for validation.*

**Key Points:**

- Data is encrypted at rest and in transit.
- Certificates are signed and verified without central authority.
- Security is a first-class concern.

=== Privacy: Minimal Backend Logging and Analytics

To maximize privacy, *konnektoren.help* does not use backend logging.
Google Analytics is used sparingly, only for product improvement and in compliance with privacy standards.

**Best Practices:**

- No personal data is logged server-side.
- Analytics are anonymized and opt-in where possible.

=== Achievement System

The achievement system motivates users and recognizes progress in learning German grammar.

==== Overview

1. Achievements are defined in YAML configuration.
2. User progress is tracked in Challenge History.
3. Achievement Evaluator checks progress against achievement conditions.
4. Unlocked achievements are displayed in the frontend.

==== Components

[plantuml, achievement-system, svg]
....
@startuml
actor User
database "Achievement\nConfiguration" as AC
database "Challenge\nHistory" as CH
component "Achievement\nEvaluator" as AE
component "Game\nStatistics" as GS
component "Frontend" as FE

User -> CH : completes challenges
CH -> GS : provides data
AC -> AE : defines achievements
GS -> AE : provides statistics
AE -> FE : updates unlocked achievements
FE -> User : displays achievements

@enduml
....

**Component Roles:**

- *Achievement Configuration*: YAML file with achievement definitions.
- *Challenge History*: Tracks completed challenges and performance.
- *Game Statistics*: Aggregates challenge data for evaluation.
- *Achievement Evaluator*: Determines unlocked achievements.
- *Frontend*: Displays achievements to users.

==== Implementation

- `AchievementDefinition`: Metadata and condition for each achievement.
- `AchievementEvaluator`: Evaluates achievements based on statistics.
- `GameStatistics`: Calculates stats from challenge history.

**Frontend** requests updated achievement info and displays progress and new achievements.

=== Self-Sovereign Identity (SSI) for Badges

Konnektoren uses SSI principles for issuing achievement badges, empowering users and enhancing privacy.

[plantuml, ssi-badge-concept, svg]
....
@startuml
actor User
component "Konnektoren Platform" as KP
component "vc.konnektoren.help" as VCI
component "SSI Wallet" as Wallet

User --> KP : Completes challenges
KP --> VCI : Requests badge issuance
VCI --> User : Issues Verifiable Credential
User --> Wallet : Stores badge
@enduml
....

**Why SSI for badges?**

1. **User Control**: Users own and manage their credentials.
2. **Portability**: Badges can be stored in any compatible SSI wallet.
3. **Privacy**: No centralized storage of achievements.
4. **Verifiability**: Third parties can verify badges without contacting Konnektoren.
5. **Interoperability**: Uses standard formats (Verifiable Credentials, OpenBadges).

**Architectural relevance:**
SSI integration aligns with decentralized, privacy-first design and future-proofs achievement credentials.
